# -------------------------------------------------------------------------------------	#
#				 CompatibleOne Cloudware				#
# ------------------------------------------------------------------------------------- #
#											#
# Ce fichier fait partie de ce(tte) oeuvre de Iain James Marshall et est mise a 	#
# disposition selon les termes de la licence Creative Commons Paternit‚ : 		#
#											#
#			 	Pas d'Utilisation Commerciale 				#
#				Pas de Modification 					#
#				3.0 non transcrit.					#
#											#
# ------------------------------------------------------------------------------------- #
# 			Copyright (c) 2011 Iain James Marshall for Prologue 		#
#				   All rights reserved					#
# ------------------------------------------------------------------------------------- #
# @configure_input@

package = @PACKAGE_NAME@
version = @PACKAGE_VERSION@

# -----------------------------------
# Library Source and Production Paths
# -----------------------------------
PATHROOT    = ../../
PATHCOXML   = $(PATHROOT)coxml/src/
PATHOCCI    = $(PATHROOT)occi/src/
PATHCORDS   = $(PATHROOT)cords/src/
PATHCOREST  = $(PATHROOT)corest/src/
PATHCOCCI   = $(PATHROOT)cocci/src/
PATHPUB     = $(PATHROOT)pubocci/src/
PATHCOPABR  = $(PATHROOT)copabr/src/
PATHPROCCI  = $(PATHROOT)procci/src/
PATHCOCARRIER = $(PATHROOT)cocarrier/src/

# -----------------------------------
# Library Definitions
# -----------------------------------
LIBUUID     = -luuid
LIBTHREAD   = -lpthread
LIBSSL      = /usr/lib/libssl.so
LIBOCCI     = $(PATHLIB)libocci.so
LIBCOXML    = $(PATHLIB)libcoxml.so
LIBCORDS    = $(PATHLIB)libcords.so $(LIBCOXML)
LIBCOREST   = $(PATHLIB)libcorest.so $(LIBUUID) $(LIBTHREAD) $(LIBSSL)
LIBCOCCI    = $(PATHLIB)libcocci.so $(LIBOCCI) $(LIBCORDS) $(LIBCOREST)
LIBCOPUB    = $(PATHLIB)libpubocci.so $(LIBCOCCI)
LIBCOPABR   = $(PATHLIB)libcopabr.so $(LIBCOPUB)
LIBCOCARRIER = $(PATHLIB)libcocarrier.so

# -----------------------------------
# Compilation and Link Definitions
# -----------------------------------
INCLUDE   = -I$(PATHCOXML)
SHARED    = -fPIC -shared
DEBUG     = -g -ggdb
OPTIONS   = -DUNIX -Dunix -DCONE $(SYSOPT)

Makefile: Makefile.in ../config.status
	cd .. && ./config.status $@

config.status: configure
	cd .. && ./config.status --recheck

all: ../lib/libcorest.so

clean:
	-rm *.o *.so

install:
	$(SUDO) cp ../lib/libcorest.so $(PATHLIB)
	
.c.o:
	gcc -c $(DEBUG) $(OPTIONS) $(INCLUDE) $*.c

base64.o: base64.c
encode64.o: encode64.c
socket.o: socket.c
tlsrest.o: tlsrest.c
tlsload.o: tlsload.c
restlog.o: restlog.c
restserver.o: restserver.c
restclient.o: restclient.c url.c

../lib/libcorest.so: restserver.o restclient.o restlog.o tlsrest.o tlsload.o socket.o base64.o encode64.o
	gcc $(DEBUG) $(SHARED) -o $@ $? $(LIBUUID) $(LIBTHREAD) $(LIBSSL)

.PHONY: all clean install

